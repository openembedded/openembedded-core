CVE: CVE-2019-20218
Upstream-Status: Backport
Signed-off-by: Ross Burton <ross.burton@intel.com>

From 6bbd76d34f29f61483791231f2ce579dcadab8a5 Mon Sep 17 00:00:00 2001
From: Dan Kennedy <danielk1977@gmail.com>
Date: Fri, 27 Dec 2019 20:54:42 +0000
Subject: [PATCH] Do not attempt to unwind the WITH stack in the Parse object
 following an error. This fixes a separate case to [de6e6d68].

FossilOrigin-Name: d29edef93451cc67a5d69c1cce1b1832d9ca8fff1f600afdd51338b74d077b92
---
 sqlite3.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sqlite3.c b/sqlite3.c
index 5bc06c8..408ec4c 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -130570,7 +130570,7 @@ static int selectExpander(Walker *pWalker, Select *p){
 
   /* Process NATURAL keywords, and ON and USING clauses of joins.
   */
-  if( db->mallocFailed || sqliteProcessJoin(pParse, p) ){
+  if( pParse->nErr || db->mallocFailed || sqliteProcessJoin(pParse, p) ){
     return WRC_Abort;
   }
 
-- 
2.24.1

