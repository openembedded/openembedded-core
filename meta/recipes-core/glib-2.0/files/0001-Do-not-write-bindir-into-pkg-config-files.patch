From 6fe3965383d94b3030e85ab899955858710fec5c Mon Sep 17 00:00:00 2001
From: Alexander Kanavin <alex.kanavin@gmail.com>
Date: Fri, 15 Feb 2019 11:17:27 +0100
Subject: [PATCH] Do not prefix executables with $bindir in pkg-config files

This would otherwise break when using the executables to build other target
components (we need to rely on PATH containing the paths to utilities,
rather than use target paths).

Upstream-Status: Inappropriate [upstream wants the paths in .pc files]
Signed-off-by: Alexander Kanavin <alex.kanavin@gmail.com>
---
 gio/meson.build  | 17 +++++++++--------
 glib/meson.build |  7 ++++---
 2 files changed, 13 insertions(+), 11 deletions(-)

diff --git a/gio/meson.build b/gio/meson.build
index 2f8f188..57c48d2 100644
--- a/gio/meson.build
+++ b/gio/meson.build
@@ -912,17 +912,18 @@ libgio_dep = declare_dependency(link_with : libgio,
 pkg.generate(libgio,
   requires : ['glib-2.0', 'gobject-2.0'],
   variables : [
+    'bindir=' + '${prefix}' / get_option('bindir'),
     'schemasdir=' + '${datadir}' / schemas_subdir,
     'dtdsdir=' + '${datadir}' / dtds_subdir,
     'giomoduledir=' + pkgconfig_giomodulesdir,
-    'gio=' + '${bindir}' / 'gio',
-    'gio_querymodules=' + pkgconfig_multiarch_bindir / 'gio-querymodules',
-    'glib_compile_schemas=' + pkgconfig_multiarch_bindir / 'glib-compile-schemas',
-    'glib_compile_resources=' + '${bindir}' / 'glib-compile-resources',
-    'gdbus=' + '${bindir}' /'gdbus',
-    'gdbus_codegen=' + '${bindir}' / 'gdbus-codegen',
-    'gresource=' + '${bindir}' / 'gresource',
-    'gsettings=' + '${bindir}' / 'gsettings',
+    'gio=gio',
+    'gio_querymodules=gio-querymodules',
+    'glib_compile_schemas=glib-compile-schemas',
+    'glib_compile_resources=glib-compile-resources',
+    'gdbus=gdbus',
+    'gdbus_codegen=gdbus-codegen',
+    'gresource=gresource',
+    'gsettings=gsettings',
   ],
   uninstalled_variables : [
     'gio=${prefix}/gio/gio',
diff --git a/glib/meson.build b/glib/meson.build
index 209bcbf..a86cfd3 100644
--- a/glib/meson.build
+++ b/glib/meson.build
@@ -464,9 +464,10 @@ pkg.generate(libglib,
   subdirs : ['glib-2.0'],
   extra_cflags : ['-I${libdir}/glib-2.0/include'] + win32_cflags,
   variables : [
-    'glib_genmarshal=' + '${bindir}' / 'glib-genmarshal',
-    'gobject_query=' + '${bindir}' / 'gobject-query',
-    'glib_mkenums=' + '${bindir}' / 'glib-mkenums',
+    'bindir=' + '${prefix}' / get_option('bindir'),
+    'glib_genmarshal=glib-genmarshal',
+    'gobject_query=gobject-query',
+    'glib_mkenums=glib-mkenums',
     'glib_valgrind_suppressions=' + '${datadir}' /
       valgrind_suppression_file_install_subdir /
       fs.name(valgrind_suppression_file),
